{% extends "layout.html" %}


{% block scripts %}

<script>

  $(function () {

    $('select[multiple]').select2({
      width: '600px',
    });

    $('.tagit').select2({
      width: '600px',
      tags: [],
      tokenSeparators: []
    });

    $('#spatial').on('change', function () {

      if($(this).val() == '1') {
        $('#spatial_scale').parents('.row').show();
        $('#countries').parents('.row').show();
      } else {
        $('#spatial_scale').parents('.row').hide();
        $('#countries').parents('.row').hide();
      }

    }).change();

    $('#ecosystems').on('change', function () {
      if($(this).val() == '1') {
        $('#ecosystem-types-issues').parents('.row').show();
      } else {
        $('#ecosystem-types-issues').parents('.row').hide();
      }
    }).change();

    $('#ecosystem_services').on('change', function () {
      if($(this).val() == '1') {
        $('#ecosystem-service-types').parents('.row').show();
      } else {
        $('#ecosystem-service-types').parents('.row').hide();
      }
    }).change();


    $('.ecosystem-type-other').on('click', function (e) {
      e.preventDefault();
      var rel = $(this).data('rel');
      var type = $(this).data('type');
      var row = $(rel).find('tbody tr:last');
      var category = prompt('Add another category');
      var fields = ['urban', 'cropland', 'grassland', 'woodland', 'heathland',
                    'vegetated', 'wetland', 'rivers', 'marine'];

      if(!category) return;

      row.find('td').eq(0).append($('<div>').attr({
        'class': 'category-left',
      }).text(category));

      $.each(fields, function (i, value) {
        var parent_html = $('<li>');
        var input = $('<input>').attr({
          'type': 'checkbox',
          'value': category,
          'name': 'ecosystem_types_' + type + '-' + value
        })
        parent_html.append(input);
        row.find('td').eq(i+1).find('ul').append(parent_html);
      });

    });

    $('.ecosystem-service-typye-other').on('click', function (e) {
      e.preventDefault();
      var rel = $(this).data('rel');
      var row = $(rel).find('tbody tr:last');
      var category = prompt('Add another category');
      var fields = ['provisioning', 'regulating', 'cultural'];

      if(!category) return;

      row.find('td').eq(0).append($('<div>').attr({
        'class': 'category-left',
      }).text(category));

      $.each(fields, function (i, value) {
        var parent_html = $('<li>')
        var input = $('<input>').attr({
          'type': 'checkbox',
          'value': category,
          'name': 'ecosystem_services_types-' + value
        });
        parent_html.append(input);
        row.find('td').eq(i+1).find('ul').append(parent_html);
      });

    });

  });

</script>

{% endblock %}


{% macro render_field(field) %}

  <label for="{{ field.id }}">
    {{ field.label.text }}
    {% if field.flags.required %}
      <span class="required">*</span>
    {% endif %}
  </label>
  <div class="field">
    {{ field(**kwargs) }}
    {% if field.errors %}
      <div class="error">{{ field.errors[0] }}</div>{% endif %}
  </div>

{% endmacro %}


{% macro render_other(field) %}
  <div class="other">
    <p>other</p>
    {{ review_form.content_other(class_='tagit') }}
  </div>
{% endmacro %}


{% block content %}

<form method="POST" enctype="multipart/form-data">

  <fieldset>
    <legend>Resource identification</legend>

    <div class="row">
      {{ render_field(resource_form.title) }}
    </div>

    <div class="row">
      {{ render_field(resource_form.language) }}
    </div>

    <div class="row">
      {{ render_field(resource_form.english_title) }}
    </div>

    <div class="row">
      {{ render_field(resource_form.authors) }}
    </div>

    <div class="row">
      {{ render_field(resource_form.organisations) }}
    </div>

    <div class="row">
      {{ render_field(resource_form.year_of_publication) }}
    </div>

    <div class="row">
      {{ render_field(review_form.origin) }}
      {{ render_other(review_form.origin_other) }}
    </div>

  </fieldset>

  <fieldset>
    <legend>Document availability and status</legend>

    <div class="row">
      {{ render_field(review_form.status) }}
    </div>

    <div class="row">
      {{ render_field(review_form.availability) }}
    </div>

    <div class="row">
      {{ render_field(review_form.languages) }}
    </div>

    <div class="row">
      {{ render_field(review_form.url) }}
    </div>

    <div class="row">
      {{ render_field(review_form.filename) }}
    </div>

    <div class="row">
      {{ render_field(review_form.spatial) }}
    </div>

    <div class="row">
      {{ render_field(review_form.spatial_scale) }}
    </div>

    <div class="row">
      {{ render_field(review_form.countries) }}
    </div>

    <div class="row">
      {{ render_field(review_form.content) }}
      {{ render_other(review_form.content_other) }}
    </div>

    <div class="row">
      {{ render_field(review_form.key_elements) }}
    </div>

    <div class="row">
      {{ render_field(review_form.ecosystems) }}
    </div>

    <div class="row">
      {{ review_form.ecosystem_types_issues }}
      <div class="other">
        <a href="" class="ecosystem-type-other"
           data-rel="#ecosystem-types-issues"
           data-type="issues">
          Add another</a>
      </div>
      {{ review_form.ecosystem_types_methods }}
      <div class="other">
        <a href="" class="ecosystem-type-other"
           data-rel="#ecosystem-types-methods"
           data-type="methods">
          Add another</a>
      </div>
    </div>

    <div class="row">
      {{ render_field(review_form.ecosystem_services) }}
    </div>

     <div class="row">
      {{ review_form.ecosystem_services_types }}
      <div class="other">
        <a href="" class="ecosystem-service-typye-other"
           data-rel="#ecosystem-service-types">
          Add another</a>
      </div>
    </div>

    <div class="row">
      {{ render_field(review_form.feedback) }}
      <div class="other">
        <p>other</p>
        {{ review_form.feedback_other }}
      </div>
    </div>

  </fieldset>

  <div class="row">
    <button type="submit">Submit</button>
  </div>

</form>

{% endblock %}